Output Schema
=============

This page documents the files and keys written by MHX runs. The schema is
stable and should be treated as part of the public API.

Run directories
--------------

Simulation and inverse-design runs are written under:

``outputs/runs/<timestamp>_<tag>/``

Files:

- ``config.yaml``: full configuration (sim, objective, model, training)
- ``api``: API versions for sim/inverse/physics/npz (inside ``config.yaml``)
- ``history.npz``: inverse-design training history (only for inverse design)
- ``solution_initial.npz`` / ``solution_mid.npz`` / ``solution_final.npz``:
  full diagnostics for baseline/mid/final runs
- ``figures/``: figures generated by ``mhx figures``
- ``logs.txt``: simple run diagnostics and sanity checks

Simulation NPZ keys
-------------------

The solver output NPZ (e.g., ``solution_final.npz``) contains:

Grid + parameters:

- ``Nx, Ny, Nz, Lx, Ly, Lz``
- ``nu, eta, B0, a, B_g, eps_B``
- ``t0, t1, n_frames, dt0``
- ``equilibrium_mode``
- ``schema_version``
- ``mhx_version``

Time series:

- ``ts``
- ``v_hat`` (spectral velocity, shape ``[T, 3, Nx, Ny, Nz]``)
- ``B_hat`` (spectral magnetic field, shape ``[T, 3, Nx, Ny, Nz]``)
- ``E_kin`` and ``E_mag``
- ``mode_amp_series`` (tearing mode amplitude)
- ``tearing_amp_series`` (band RMS amplitude)
- ``Az_xpt_series`` and ``E_rec_series`` (reconnection proxy)
- ``Az_midplane_series`` and ``complexity_series``

Single-time diagnostics:

- ``E_kin_end``, ``E_mag_end``
- ``gamma_fit`` (growth rate fit)
- ``lnA_fit``, ``mask_lin`` (fit diagnostics)
- ``Az_final_mid``
- ``complexity_final``
- ``n_plasmoids_final``

Sanity checks:

- ``sanity_finite_ok``
- ``sanity_nonneg_ok``
- ``sanity_energy_ratio``
- ``sanity_energy_ratio_warn``

Inverse-design history NPZ
--------------------------

``history.npz`` contains:

- ``loss``
- ``log10_eta``, ``log10_nu``
- ``eta``, ``nu``
- ``f_kin``, ``complexity``
- ``target_f_kin``, ``target_complexity``, ``lambda_complexity``

Manifest
--------

The paper/repro pipeline writes ``outputs/manifest.json`` with:

- ``timestamp``
- ``git_rev`` (if available)
- ``commands`` (scripts executed)
- ``outputs`` (files generated)
- ``run_configs`` (bundled config YAMLs)
- ``hashes`` (sha256 for each output)
- ``elapsed_sec``
